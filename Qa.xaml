<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Flashnote.Qa"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             xmlns:local="clr-namespace:Flashnote">

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <!-- 上部コンテンツを可変サイズに -->
            <RowDefinition Height="Auto"/>
            <!-- ボタンの高さ分 -->
        </Grid.RowDefinitions>

        <!-- 列を追加：左=資料表示（PDF）、右=ノート/問題 -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <!-- 資料表示エリア（左カラム） -->
        <Grid Grid.Row="0" Grid.Column="0" Padding="0" x:Name="MaterialContainer" IsVisible="False">
            <VerticalStackLayout Spacing="0" Padding="0">
                <Grid Padding="8" BackgroundColor="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Label x:Name="MaterialFileNameLabel" Text="" VerticalOptions="Center" FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource TextLight}, Dark={StaticResource TextDark}}" />
                    <Button Text="閉じる"  Grid.Column="1" />
                </Grid>
                <WebView x:Name="MaterialWebView" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" />
            </VerticalStackLayout>
        </Grid>

        <!-- 問題表示エリア（スクロール対応） 右カラムに移動 -->
        <ScrollView x:Name="QuestionScrollView" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,10">
            <VerticalStackLayout Spacing="10" Padding="10">
                <!-- 問題数表示 -->
                <Label x:Name="QuestionNumberLabel"
                       Text="問題 1 / 10"
                       FontSize="16"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       Margin="0,0,0,10"
                       TextColor="{AppThemeBinding Light={StaticResource TextLight}, Dark={StaticResource TextDark}}" />
                
                <!-- 問題表示エリア -->
                <Grid x:Name="QuestionContainer">

                    <!-- 基本・穴埋めカード -->
                    <VerticalStackLayout x:Name="BasicCardLayout"
                                         IsVisible="False"
                                         Spacing="10">
                        <Frame Padding="10" HasShadow="False" CornerRadius="8"
                               Background="{StaticResource BackgroundBrush}"
                               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
                            <local:RichTextLabel x:Name="FrontPreviewLabel"
                                                FontSize="16"
                                                LineBreakMode="WordWrap"/>
                        </Frame>
                        
                        <!-- テキスト入力エリア -->
                        <VerticalStackLayout x:Name="TextInputContainer" 
                                            IsVisible="False"
                                            Spacing="10"
                                            Padding="10">
                            <Label Text="回答を入力してください:" 
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource TextLight}, Dark={StaticResource TextDark}}" />
                            <ScrollView>
                                <VerticalStackLayout x:Name="TextInputFieldsContainer" 
                                                    Spacing="8"/>
                            </ScrollView>
                        </VerticalStackLayout>
                        
                        <!-- テキスト入力モードトグル -->
                        <HorizontalStackLayout x:Name="TextInputToggleLayout" 
                                              Spacing="10" 
                                              HorizontalOptions="Center"
                                              Margin="0,10,0,0">
                            <Label Text="テキスト入力モード:" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light={StaticResource TextLight}, Dark={StaticResource TextDark}}" />
                            <Switch x:Name="TextInputModeToggle" 
                                    IsToggled="False"
                                    Toggled="OnTextInputModeToggled"/>
                        </HorizontalStackLayout>
                        
                        <Frame Padding="10" HasShadow="False" CornerRadius="8"
                               x:Name="BackPreviewFrame"
                               IsVisible="False"
                               Background="{StaticResource BackgroundBrush}"
                               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
                            <local:RichTextLabel x:Name="BackPreviewLabel"
                                                FontSize="16"
                                                LineBreakMode="WordWrap"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- 選択肢カード -->
                    <VerticalStackLayout x:Name="ChoiceCardLayout"
                                         IsVisible="False"
                                         Spacing="10">
                        <Frame Padding="10" HasShadow="False" CornerRadius="8"
                               Background="{StaticResource BackgroundBrush}"
                               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
                            <local:RichTextLabel x:Name="ChoiceQuestionLabel"
                                                FontSize="16"
                                                LineBreakMode="WordWrap"/>
                        </Frame>
                        <VerticalStackLayout x:Name="ChoiceContainer" Spacing="5" Padding="10"/>
                        <Frame Padding="10" HasShadow="False" CornerRadius="8"
                               x:Name="ChoiceExplanationFrame"
                               IsVisible="False"
                               Background="{StaticResource BackgroundBrush}"
                               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
                            <local:RichTextLabel x:Name="ChoiceExplanationLabel"
                                                FontSize="16"
                                                LineBreakMode="WordWrap"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- 画像穴埋めカード -->
                    <VerticalStackLayout x:Name="ImageFillCardLayout"
                                         IsVisible="False"
                                         Spacing="10">
                        <Frame Padding="5" HasShadow="False" CornerRadius="8"
                               Background="{StaticResource CanvasBackgroundBrush}"
                               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
                            <skia:SKCanvasView x:Name="CanvasView"
                                               HeightRequest="300"
                                               WidthRequest="500"
                                               IsEnabled="True"
                                               PaintSurface="OnCanvasViewPaintSurface"
                                               EnableTouchEvents="False"/>
                        </Frame>
                    </VerticalStackLayout>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- 正解・不正解ボタン（固定位置） -->
        <Frame Grid.Row="1" Grid.ColumnSpan="2" 
               Padding="10,15"
               HasShadow="True"
               CornerRadius="0"
               Background="{StaticResource BackgroundBrush}"
               BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}">
            <HorizontalStackLayout HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   Spacing="15">
                <Button x:Name="ShowAnswerButton"
                        Text="解答を表示"
                        Clicked="OnShowAnswerClicked"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        WidthRequest="120"/>

                <Button x:Name="ViewMaterialButton"
                        Text="資料を見る"
                        
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        WidthRequest="120"/>

                <Button x:Name="Correct"
                        Text="正解"
                        Clicked="OnCorrectClicked"
                        IsVisible="False"
                        WidthRequest="80"
                        BackgroundColor="Green"
                        TextColor="White"/>
                <Grid IsVisible="False" x:Name="SeparatorGrid">
                    <BoxView HeightRequest="2"
                             WidthRequest="30"
                             VerticalOptions="Center"
                             BackgroundColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}" />
                </Grid>                
                <Button x:Name="Incorrect"
                        Text="不正解"
                        Clicked="OnIncorrectClicked"
                        IsVisible="False"
                        WidthRequest="80"
                        BackgroundColor="Red"
                        TextColor="White"/>
                <Button x:Name="NextButton"
                        Text="次へ"
                        Clicked="OnNextClicked"
                        IsVisible="False"
                        WidthRequest="80"/>
            </HorizontalStackLayout>
        </Frame>
    </Grid>
</ContentPage>
